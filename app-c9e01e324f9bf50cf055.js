webpackJsonp([1],[function(e,n,t){t(33),e.exports=t(25)},,,,,function(e,n,t){"use strict";function s(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function o(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function e(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(n,t,s){return t&&e(n.prototype,t),s&&e(n,s),n}}(),r=t(1),c=function(e){function n(e,t){s(this,n);var o=i(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return o.group=e,o.sticker=t,o}return o(n,e),a(n,[{key:"summary",get:function(){return"[Sticker] "+this.sticker}}]),n}(r.TypedMessage);n.default=c,(0,r.messageField)(["group","sticker"])(c),(0,r.messageType)(100)(c)},,function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.smileys=["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘","😗","😙","😚","🙂","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🤧","😇","🤠","🤡","🤥","🤫","🤭","🧐","🤓","😈","👿","👹","👺","💀","👻","👽","🤖","💩","😺","😸","😹","😻","😼","😽","🙀","😿","😾"],n.stickers=[["emoji-sticker",[["happy","https://lc-kntfgfqm.cn-n1.lcfile.com/0f5c5ce64dbdee015f3e.svg"],["laughing","https://lc-kntfgfqm.cn-n1.lcfile.com/5cf0dd10f240f66fd779.svg"],["cool","https://lc-kntfgfqm.cn-n1.lcfile.com/3a0eca4aa36cf7603c0e.svg"],["laughing-with-tears","https://lc-kntfgfqm.cn-n1.lcfile.com/8ff3ab43c86d721e64a8.svg"],["confused","https://lc-kntfgfqm.cn-n1.lcfile.com/7460b8e0f2302a1e527d.svg"],["crying","https://lc-kntfgfqm.cn-n1.lcfile.com/0b2c45cd6ccbb9ad7796.svg"],["surprised","https://lc-kntfgfqm.cn-n1.lcfile.com/aa91b0df2b5d7b98695d.svg"],["shocked","https://lc-kntfgfqm.cn-n1.lcfile.com/4025addb60eb26095cd0.svg"],["sad","https://lc-kntfgfqm.cn-n1.lcfile.com/ae6e286448b009f9a0cf.svg"],["angry","https://lc-kntfgfqm.cn-n1.lcfile.com/df6d6f03c316a5d008f1.svg"],["sick","https://lc-kntfgfqm.cn-n1.lcfile.com/4f6eb7f95f750b2eff3a.svg"],["greed","https://lc-kntfgfqm.cn-n1.lcfile.com/61a83f01b63573fa2dc4.svg"]],["designed by freepik from Flaticon","https://www.flaticon.com/authors/freepik"]],["animal",[["dog","https://lc-kntfgfqm.cn-n1.lcfile.com/fc4de126619d4839af70.svg"],["cat","https://lc-kntfgfqm.cn-n1.lcfile.com/29c540f5f272d63461e9.svg"],["panda-bear","https://lc-kntfgfqm.cn-n1.lcfile.com/1e39bb10e7f02379cf9e.svg"],["lion","https://lc-kntfgfqm.cn-n1.lcfile.com/260bcf78faa9e915f230.svg"],["tiger","https://lc-kntfgfqm.cn-n1.lcfile.com/a2996e17cd43a471b305.svg"],["koala","https://lc-kntfgfqm.cn-n1.lcfile.com/d929b981e6896c034d3c.svg"],["giraffe","https://lc-kntfgfqm.cn-n1.lcfile.com/7be12ba23b2adc6c1391.svg"],["frog","https://lc-kntfgfqm.cn-n1.lcfile.com/08471c8b3367ee175acd.svg"],["rabbit","https://lc-kntfgfqm.cn-n1.lcfile.com/37cb33111be9c6cd0c75.svg"],["raccoon","https://lc-kntfgfqm.cn-n1.lcfile.com/48fc79f68974c621c443.svg"],["bear","https://lc-kntfgfqm.cn-n1.lcfile.com/b85a37ff48219827d71b.svg"],["fox","https://lc-kntfgfqm.cn-n1.lcfile.com/20c1ad98ba2af71ec9c5.svg"]],["designed by freepik from Flaticon","https://www.flaticon.com/authors/freepik"]]]},function(e,n,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function o(e,n){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?e:n}function a(e,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(e,n):e.__proto__=n)}Object.defineProperty(n,"__esModule",{value:!0}),n.TypingIndicatorPlugin=n.TypingStatusMessage=void 0;var r=function(){function e(e,n){for(var t=0;t<n.length;t++){var s=n[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(n,t,s){return t&&e(n.prototype,t),s&&e(n,s),n}}(),c=t(1),l=t(17),u=s(l),d=n.TypingStatusMessage=function(e){function n(e){i(this,n);var t=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.value=e,t}return a(n,e),n}(c.TypedMessage);d.STATUS={TYPING:1,FINISHED:0},d.sendOptions={transient:!0},(0,c.messageField)(["value"])(d),(0,c.messageType)(-100)(d);var m=function(e){function n(e){i(this,n);var t=o(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._client=e,t._handleMessage=t._handleMessage.bind(t),t._reset(),t}return a(n,e),r(n,[{key:"_reset",value:function(){this.typingClients=[],this._typingClientsActiveTimers={},this._lastSendStatus={type:null,timestamp:0}}},{key:"setConversation",value:function(e){this._conversation&&(this._conversation.off("_typingstatusmessage",this._handleMessage),this._reset()),e.on("_typingstatusmessage",this._handleMessage),this._conversation=e}},{key:"_handleMessage",value:function(e){var n=e.from,t=e.value;this._updateTypingClients(n,t)}},{key:"_updateTypingClients",value:function(e,n){var t=this,s=void 0!==this._typingClientsActiveTimers[e],i=n===d.STATUS.TYPING;this._typingClientsActiveTimers[e]&&clearTimeout(this._typingClientsActiveTimers[e]),i?this._typingClientsActiveTimers[e]=setTimeout(function(){t._updateTypingClients(e,d.STATUS.FINISHED)},5e3):delete this._typingClientsActiveTimers[e],s^i&&(this.typingClients=Object.keys(this._typingClientsActiveTimers),this.emit("change"))}},{key:"updateStatus",value:function(e){var n=this;return Promise.resolve().then(function(){var t=n._conversation;if(!t)throw new Error("must set a Conversation before updating status.");if(n._lastSendStatus){if(e===d.STATUS.TYPING){if(n._lastSendStatus.timestamp+3e3>Date.now())return;var s=new d(d.STATUS.TYPING);return n._lastSendStatus={type:d.STATUS.TYPING,timestamp:Date.now()},t.send(s)}if(e===d.STATUS.FINISHED){if(n._lastSendStatus.type===d.STATUS.FINISHED)return;if(n._lastSendStatus.timestamp+5e3<Date.now())return;var i=new d(d.STATUS.FINISHED);return n._lastSendStatus={type:d.STATUS.FINISHED,timestamp:0},t.send(i)}}})}}]),n}(u.default);n.TypingIndicatorPlugin={name:"test",messageClasses:[d],beforeMessageDispatch:function(e,n){return e.type!==d.TYPE||(n.emit("_typingstatusmessage",e),!1)},onIMClientCreate:function(e){e.createTypingIndicator=function(){return new m(e)}}}},,,,,,,,,,,function(e,n){},function(e,n){},function(e,n){},function(e,n){},function(e,n){},,function(e,n,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}var i=t(2),o=s(i);o.default.module("leanMessage").run(["$templateCache",function(e){e.put("app/conversation/conversation.html",'<md-sidenav class="menu md-sidenav-left md-whiteframe-z2" layout="column" ng-class="{ \'under-mask\': !conversation.isMenuOpen } " md-component-id="menu" md-is-open="conversation.isMenuOpen" md-is-locked-open="$mdMedia(\'gt-sm\') || !currentConversation">\n  <div flex layout="column" style="overflow:auto">\n    <div class="logo">LeanMessage</div>\n    <md-list flex>\n\n      <!-- Robots List-->\n      <md-divider></md-divider>\n      <md-subheader class="md-no-sticky">服务号</md-subheader>\n      <md-list-item ng-repeat="conv in sysConvs | orderBy:\'-lastMessageAt\' track by conv.id" ng-click="changeTo(conv)" ng-class="{\'active\': conv.id === currentConversation.id}">\n        <p layout="row" layout-align="center center">\n          {{::conv.name}}\n          <span class="last-message" flex>{{conv.lastMessage.summary}}</span>\n          <span ng-if="conv.unreadMessagesCount" class="unreadCount">{{conv.unreadMessagesCount}}</span>\n        </p>\n      </md-list-item>\n      <div class="empty-list-hint" layout-padding>此应用还未创建系统对话</div>\n      <!-- Robots List End -->\n\n      <!-- Transiant Convsations List-->\n      <md-divider></md-divider>\n      <md-subheader class="md-no-sticky">聊天室</md-subheader>\n      <md-list-item ng-repeat="conv in transConvs | orderBy:\'-lastMessageAt\' track by conv.id" ng-click="changeTo(conv)" ng-class="{\'active\': conv.id === currentConversation.id}">\n        <p layout="row" layout-align="center center">\n          {{::conv.name}}\n          <span class="last-message" flex>\n            <span ng-if="conv.mentioned" class="mentioned">有人@你</span>\n            {{conv.lastMessage.from}}<span ng-if="conv.lastMessage.from">: </span>{{conv.lastMessage.summary}}\n          </span>\n          <span ng-if="conv.unreadMessagesCount" class="unreadCount">{{conv.unreadMessagesCount}}</span>\n        </p>\n      </md-list-item>\n      <div class="empty-list-hint" layout-padding>此应用还未创建聊天室</div>\n      <!-- Transiant Convsations List End -->\n\n      <!-- Group Conversations List -->\n      <md-divider></md-divider>\n      <md-subheader class="md-no-sticky">群聊</md-subheader>\n      <md-list-item ng-repeat="conv in normalConvs | orderBy:\'-lastMessageAt\' track by conv.id" ng-if="(conv.members.length > 2)" ng-click="changeTo(conv)" ng-class="{\'active\': conv.id === currentConversation.id}">\n        <p layout="row" layout-align="center center">\n          {{conv.name || \'群 \' + conv.id.slice(-4) }}\n          <span class="last-message" flex>\n            <span ng-if="conv.unreadMessagesMentioned" class="mentioned">有人@你</span>\n            {{conv.lastMessage.from}}<span ng-if="conv.lastMessage.from">: </span>{{conv.lastMessage.summary}}\n          </span>\n          <span ng-if="conv.unreadMessagesCount" class="unreadCount">{{conv.unreadMessagesCount}}</span>\n        </p>\n      </md-list-item>\n      <div class="empty-list-hint" layout-padding>在单聊中邀请成员开始群聊</div>\n      <!-- Group Conversations List End -->\n\n      <!-- Single Conversations List -->\n      <md-divider></md-divider>\n      <md-subheader class="md-no-sticky">单聊</md-subheader>\n      <md-list-item ng-repeat="conv in normalConvs | orderBy:\'-lastMessageAt\' track by conv.id" ng-if="conv.members.length === 2" ng-click="changeTo(conv)" ng-class="{\'active\': conv.id === currentConversation.id}">\n        <p layout="row" layout-align="center center">\n          {{getSingleConvTarget(conv.members)}}\n          <span class="last-message" flex>{{conv.lastMessage.summary}}</span>\n          <span ng-if="conv.unreadMessagesCount" class="unreadCount">{{conv.unreadMessagesCount}}</span>\n        </p>\n      </md-list-item>\n      <div class="empty-list-hint" layout-padding>在聊天窗口点击任意用户 ID 开始单聊</div>\n    </md-list>\n  </div>\n  <!-- Single Conversations List End -->\n\n  <!--Personal Info-->\n  <md-divider></md-divider>\n  <div class="user" layout layout-align="center center" layout-padding>\n    <!--<img gravatar-src-once="transientEmail" gravatar-size="40">-->\n    <span flex>当前用户：{{imClient.id}}</span>\n    <md-button class="md-icon-button" aria-label="Logout" ng-click="logout()">\n      <md-icon>exit_to_app</md-icon>\n    </md-button>\n  </div>\n  <!--Personal Info End-->\n</md-sidenav>\n\n<!-- Nested Views for conversations.message -->\n<div layout flex ui-view>\n  <a href="https://github.com/leancloud/leanmessage-demo" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>    \n</div>\n\n<!-- NetWorkErrorMask -->\n<div class="network-error" layout="column" layout-align="center center" ng-if="networkError">\n  <md-icon>{{ networkErrorIcon }}</md-icon>\n  <div>\n    {{ networkError }}\n    <md-button ng-click="retry()" ng-if="networkShowRetry">立即重试</md-button>\n  </div>\n</div>'),e.put("app/login/logging.html","<h1>正在登录……</h1>"),e.put("app/login/login.html",'<div class="login-container" layout layout-align="center center" flex>\n  <a href="https://github.com/leancloud/leanmessage-demo" class="github-corner" aria-label="View source on Github"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#70B7FD; color:#fff; position: absolute; top: 0; border: 0; right: 0" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>\n  <md-whiteframe class="md-whiteframe-z1 login-frame" layout layout-align="center center">\n    <md-content class="loginForm" layout-align="center" layout="column" flex>\n      <form name="loginForm" ng-submit="login()" layout="column" layout-align="center" flex>\n        <div class="logo">LeanMessage</div>\n        <div class="client-form" layout="column">\n          <md-input-container>\n            <label>ID</label>\n            <input ng-model="user.id" required>\n          </md-input-container>\n          <md-button flex ng-click="login()">开始聊天</md-button>\n        </div>\n      </form>\n    </md-content>\n  </md-whiteframe>\n</div>\n'),e.put("app/components/message/message.html",'<div ng-if="displayTime" class="time">{{::message.timestamp | date:\'MM-dd HH:mm\'}}</div>\n<div class="message" ng-if="::message.id" ng-class="::{mine: isMine, mentioned: message.mentioned}" layout="column">\n    <div class="user" ng-if="displayClientId" ng-click="onNameClick()">{{ ::message.from }}</div>\n    <div ng-if="::message.type === RecalledMessage.TYPE" class="action-message">\n        该消息已撤回\n    </div>\n    <div ng-if="::message.type !== RecalledMessage.TYPE" layout layout-align="start">\n        <div layout="column" layout-align="space-between start">\n            <div class="operations">\n                <md-button class="md-icon-button" ng-if="::isMine" aria-label="Recall" ng-click="onRecallClick()">\n                    <md-icon>delete</md-icon>\n                </md-button>\n            </div>\n            <div layout layout-align="start end">\n                <span class="tips" title="{{groupReadClients}}" ng-if="groupReadClients">{{ groupReadHint }}</span>\n                <span class="tips" ng-if="isLastDelivered ">已送达</span>\n                <span class="tips" ng-if="isLastRead">已读</span>\n                <md-icon ng-if="message.status === MessageStatus.SENDING">reply</md-icon>\n                <md-icon ng-if="message.status === MessageStatus.FAILED">error</md-icon>\n            </div>\n        </div>\n        <div class="image" ng-if="::message.type === ImageMessage.TYPE">\n            <a ng-href="{{ ::message.getFile().url() }}" target="_blank">\n                <img ng-src="{{ ::message.getFile().thumbnailURL(260, 360) }}">\n            </a>\n        </div>\n        <div class="sticker" ng-if="::message.type === StickerMessage.TYPE">\n            <img ng-src="{{::stickers[message.group][message.sticker]}}" alt="{{::message.sticker}}" width="100">\n        </div>\n        <div class="content" ng-if="::message.text">{{ ::message.text }}</div>\n    </div>\n</div>\n\n<div ng-if="::!message.id" class="message" layout layout-align="center"><div class="action-message">{{ message.text }}</div></div>'),e.put("app/conversation/conversationMessage/conversation.message.html",'<div flex layout="column">\n\n  <md-toolbar>\n    <div class="md-toolbar-tools">\n      <md-button class="md-icon-button menu-button" aria-label="Menu" hide-gt-sm ng-click="toggle(\'menu\')">\n        <md-icon>menu</md-icon>\n        <span ng-if="hasUnreadMessage" class="notice"></span>\n        <span ng-if="totalUnreadMessagesCount" class="unreadCount">{{totalUnreadMessagesCount}}</span>\n      </md-button>\n      <h2>\n        <span ng-if="currentConversation.members.length !== 2">{{ currentConversation.name || \'群 \' + currentConversation.id.slice(-4) }}</span> <span ng-show="currentConversation.members.length > 2">({{currentConversation.members.length}})</span>\n        <span ng-if="currentConversation.members.length === 2">{{ getSingleConvTarget(currentConversation.members) }}</span>\n      </h2>\n      <span flex></span>\n\n      <md-button class="md-icon-button" aria-label="Add Clients" ng-if="!currentConversation.system && currentConversation.members.length <= 2" ng-click="showAddUserDialog($event)">\n        <md-icon>person_add</md-icon>\n      </md-button>\n      <md-button ng-if="currentConversation.members.length > 2" class="md-icon-button" aria-label="Online Clients" ng-click="showMembersList()">\n        <md-icon>group</md-icon>\n      </md-button>\n    </div>\n  </md-toolbar>\n\n  <!--infinite-list-->\n  <md-content infinite-list infinite-scroll="loadMoreMessages()" layout-padding flex class="messages">\n    <div class="messages-wrapper">\n      <!--messages-->\n      <message ng-repeat="(index, message) in messages" message="message" previous-message="::messages[index - 1]" next-message="messages[index + 1]" last-delivered-at="currentConversation.lastDeliveredAt" last-read-at="currentConversation.lastReadAt" group-last-read-at="currentConversation.lastReadTimestamps" is-group="::currentConversation.members.length > 2" on-name-click="createSingleConv(message.from)" on-recall-click="recall(message)" is-mine="::message.from == imClient.id"></message>\n      <!--messages end-->\n      <div id="message-view-bottom"></div>\n    </div>\n  </md-content>\n  <!--infinite-list End-->\n  <md-content class="smileys-selector" ng-if="smileysInited" ng-show="smileysShow">\n    <md-tabs md-dynamic-height md-border-bottom md-enable-disconnect>\n      <md-tab label="Smiley">\n        <md-content class="smileys">\n          <md-button ng-repeat="smiley in smileys" ng-click="insertSmiley(smiley)" class="smiley md-button md-icon-button">{{smiley}}</md-button>\n        </md-content>\n      </md-tab>\n      <md-tab ng-repeat="group in stickers" label="{{group[0]}}">\n        <md-content class="smileys">\n          <md-button ng-repeat="sticker in group[1]" ng-click="sendStickers(group[0], sticker[0])" class="smiley sticker md-button"><img ng-src="{{sticker[1]}}" aria-label="{{sticker[0]}}"></md-button>\n          <p class="note" ng-show="group[2]"><a class="link" ng-href="{{group[2][1]}}" target="_blank">{{group[2][0]}}</a></p>\n        </md-content>\n      </md-tab>\n    </md-tabs>\n  </md-content>\n\n  <div class="typing-indicator" ng-show="typingClients">\n    <span>{{typingClients}}</span>\n  </div>\n  <div layout layout-align="center center" class="editor-wrapper">\n    <form>\n      <input class="ng-hide" id="file-image" multiple="multiple" type="file" accept="image/*" ng-upload-change="sendImage($event)">\n      <label for="file-image" class="md-button md-icon-button" aria-label="Image"><md-icon>image</md-icon></label>\n    </form>\n    <form class="editor" ng-submit="sendText()" layout layout-align="center center" flex>\n      <md-button class="md-icon-button" ng-class="{\'md-primary\': smileysShow}" aria-label="Smileys" ng-click="toggleSmileysSelector()">\n        <md-icon>&#xE420;</md-icon>\n      </md-button>\n      <md-input-container md-no-float flex class="textarea">\n        <md-list class="mention-suggestion" ng-show="matchedClients.length">\n          <md-list-item ng-repeat="(index, client) in matchedClients" ng-class="{active: index === suggestionActive}" ng-click="replaceSelectedMentionedClient(index)">\n            {{client}}\n          </md-list-item>\n        </md-list>\n        <textarea id="draft" ng-model="draft" ng-trim="false" placeholder="说点什么……" ng-click="editorCursorPositionCheck($event)" ng-keydown="editorKeydownHandler($event)" ng-keyup="editorCursorPositionCheck($event)" ng-keypress="editorChangedHandler($event)"></textarea>\n      </md-input-container>\n    </form>\n    <md-button class="md-icon-button" aria-label="Send" ng-click="sendText()">\n      <md-icon>send</md-icon>\n    </md-button>\n  </div>\n</div>\n\n<!--members list -->\n<md-sidenav id="online-aside" ng-show="currentConversation.members.length > 2" class="md-sidenav-right md-whiteframe-z2" ng-class="{ \'under-mask\': !conversation.isMenuOpen } " md-component-id="online" layout="column">\n  <md-toolbar>\n    <div class="md-toolbar-tools">\n      <!--<md-button class="md-icon-button" aria-label="Back" hide-gt-sm ng-click="conversationMessage.close(\'online\')">-->\n        <!--<md-icon>arrow_back</md-icon>-->\n      <!--</md-button>-->\n      <h2 ng-show="currentConversation">{{ currentConversation.name || \'群 \' + currentConversation.id.slice(-4) }}</h2>\n      <md-button class="md-icon-button" aria-label="Edit name" ng-click="showEditNameDialog($event)">\n        <md-icon>edit</md-icon>\n      </md-button> \n      <span flex></span>\n      <!--<md-button class="md-icon-button" aria-label="Search" ng-click="conversationMessage.toggle(\'online-search\')">-->\n        <!--<md-icon>search</md-icon>-->\n      <!--</md-button>-->\n      <md-button class="md-icon-button" aria-label="Add Clients" ng-click="showAddUserDialog($event)">\n        <md-icon>person_add</md-icon>\n      </md-button> \n\n    </div>\n  </md-toolbar>\n  <md-content layout-padding class="md-body-1 member-info-disabled-warning" ng-if="memberInfoError">\n    应用未开启「成员角色管理」功能，部分功能不可用。\n  </md-content>\n  <md-list class="square-clients" flex>\n    <md-list-item ng-repeat="memberInfo in memberInfos.slice(0, maxResultsAmount)">\n      <p layout="row" layout-align="left center">\n        {{ memberInfo.memberId }}\n        <span class="client-info owner" ng-show="memberInfo.isOwner">群主</span>\n        <span class="client-info manager" ng-show="isManager(memberInfo)">管理员</span>\n      </p>\n\n      <md-menu class="md-secondary client-actions-menu">\n        <md-button class="md-icon-button">\n          <i class="material-icons">more_horiz</i>\n        </md-button>\n        <md-menu-content width="4">\n          <md-menu-item>\n            <md-button ng-click="createSingleConv(memberInfo.memberId)" ng-disabled="memberInfo === currentClientInfo">\n              <md-icon md-menu-align-target>message</md-icon>\n              单聊\n            </md-button>\n          </md-menu-item>\n          <md-menu-item ng-show="currentClientInfo.isOwner && !isAuthed(memberInfo)">\n            <md-button ng-click="updateRole(memberInfo.memberId, MemberRole.MANAGER)">\n              <md-icon md-menu-align-target>arrow_upward</md-icon>\n              升为管理员\n            </md-button>\n          </md-menu-item>\n          <md-menu-item ng-show="currentClientInfo.isOwner && isManager(memberInfo)">\n            <md-button ng-click="updateRole(memberInfo.memberId, MemberRole.MEMBER)">\n              <md-icon md-menu-align-target>arrow_downward</md-icon>\n              取消管理员\n            </md-button>\n          </md-menu-item>\n          <md-menu-item ng-show="isAuthed(currentClientInfo) && !isAuthed(memberInfo)">\n            <md-button ng-click="remove(memberInfo.memberId)">\n              <md-icon md-menu-align-target>remove</md-icon>\n              移出对话\n            </md-button>\n          </md-menu-item>\n          <md-menu-item ng-show="memberInfo === currentClientInfo">\n            <md-button ng-click="remove(memberInfo.memberId)" ng-disabled="currentClientInfo.isOwner">\n              <md-icon md-menu-align-target>remove</md-icon>\n              离开对话\n            </md-button>\n          </md-menu-item>\n        </md-menu-content>\n      </md-menu>\n\n    </md-list-item>\n    <p ng-if="currentConversation.members.length > maxResultsAmount" class="max-results-amount-hint">最多显示 {{:: maxResultsAmount }} 位成员</p>\n  </md-list>\n</md-sidenav>\n\n\n<!--// TODO : 搜索当前群聊的成员-->\n<!--<md-sidenav id="online-aside"-->\n            <!--ng-if="conversationMessage.isGroupConversation && conversationMessage.conv.members.length"-->\n            <!--class=" md-sidenav-right md-whiteframe-z2"-->\n            <!--md-component-id="online-search"-->\n            <!--layout="column">-->\n  <!--<form ng-submit="$event.preventDefault()">-->\n    <!--<div class="search-box" layout layout-align="center center">-->\n      <!--<md-button class="md-icon-button" aria-label="Back" ng-click="conversationMessage.close(\'online-search\')">-->\n        <!--<md-icon>arrow_back</md-icon>-->\n      <!--</md-button>-->\n      <!--<input type="text" flex ng-model="conversationMessage.queryString" ng-change="conversationMessage.query(conversationMessage.queryString)" placeholder="搜索在线用户" md-sidenav-focus>-->\n      <!--<md-button class="md-icon-button" aria-label="Clear" ng-click="conversationMessage.clearQuery()" ng-hide="conversationMessage.queryString===\'\'">-->\n        <!--<md-icon>clear</md-icon>-->\n      <!--</md-button>-->\n    <!--</div>-->\n    <!--<md-divider></md-divider>-->\n\n  <!--</form>-->\n  <!--<md-list class="result" flex>-->\n    <!--<md-list-item ng-repeat="client in conversationMessage.queryClients.slice(0, conversationMessage.maxResultsAmount)" ng-click="conversationMessage.changeTo(\'@\' + client)">-->\n      <!--<p class="result-item"> {{ client }} </p>-->\n    <!--</md-list-item>-->\n    <!--<p ng-if="conversationMessage.queryClients.length > conversationMessage.maxResultsAmount" class="max-results-amount-hint">最多显示 {{:: conversationMessage.maxResultsAmount }} 条结果</p>-->\n  <!--</md-list>-->\n<!--</md-sidenav>-->\n')}])},function(e,n,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}Object.defineProperty(n,"__esModule",{value:!0});var o=t(1),a=t(3),r=t(5),c=s(r),l=t(7);t(19);var u=l.stickers.reduce(function(e,n){return Object.assign(e,i({},n[0],n[1].reduce(function(e,n){return Object.assign(e,i({},n[0],n[1]))},{})))},{});n.default=function(){"ngInject";return{restrict:"E",templateUrl:"app/components/message/message.html",scope:{message:"=",previousMessage:"=",nextMessage:"=",lastDeliveredAt:"=",lastReadAt:"=",groupLastReadAt:"=",isGroup:"=",isMine:"=",onRecallClick:"&",onNameClick:"&"},link:function(e){if(Object.assign(e,{MessageStatus:o.MessageStatus,TextMessage:o.TextMessage,ImageMessage:a.ImageMessage,RecalledMessage:o.RecalledMessage,StickerMessage:c.default,stickers:u}),e.message.type||(e.message.text="[不支持的消息类型]"),e.previousMessage){if(e.previousMessage.timestamp){var n=Math.floor(e.message.timestamp/6e4),t=Math.floor(e.previousMessage.timestamp/6e4);n!==t&&(e.displayTime=!0)}}else e.displayTime=!0;e.isMine||!e.displayTime&&e.previousMessage.from===e.message.from||(e.displayClientId=!0),e.isMine&&(e.isGroup?e.unwatchGroupReceipts=e.$watch("groupLastReadAt",function(){if(e.groupLastReadAt){var n=Object.keys(e.groupLastReadAt),t=n.filter(function(n){return e.groupLastReadAt[n]>=e.message.timestamp});e.groupReadHint=t.length+" 人已读",e.groupReadClients=t.join(", "),t.length===n.length&&(e.groupReadHint="全部已读",e.unwatchGroupReceipts())}},!0):e.unwatch=e.$watchGroup(["lastReadAt","lastDeliveredAt"],function(){if(e.lastReadAt)if(e.nextMessage){if(e.nextMessage.timestamp){if(!(e.nextMessage.timestamp>e.lastReadAt))return e.isLastDelivered=e.isLastRead=!1,e.unwatch();e.message.timestamp<=e.lastReadAt&&(e.isLastRead=!0)}}else e.message.timestamp<=e.lastReadAt&&(e.isLastRead=!0);return e.isLastRead?void(e.isLastDelivered=!1):void(e.lastDeliveredAt&&(e.nextMessage?e.nextMessage.timestamp&&(e.nextMessage.timestamp>e.lastDeliveredAt?e.message.timestamp<=e.lastDeliveredAt&&(e.isLastDelivered=!0):e.isLastDelivered=!1):e.message.timestamp<=e.lastDeliveredAt&&(e.isLastDelivered=!0)))}))}}}},function(e,n,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0});var i=t(6),o=s(i);n.default=["$timeout",function(e){"ngInject";return{transclude:!0,scope:{infiniteScroll:"&",infiniteScrollDistance:"=?"},template:"<div ng-transclude></div>",link:function(n,t){void 0===n.infiniteScrollDistance&&(n.infiniteScrollDistance=200);var s=!1,i=(0,o.default)(".messages-wrapper");t.on("scroll",function(){if(!s){var a=(0,o.default)(t[0]);if(a.scrollTop()<n.infiniteScrollDistance){s=!0;var r=i.height(),c=n.infiniteScroll();!function(e){c&&"function"==typeof c.then?c.then(e):e()}(function(){return e(function(){a.scrollTop(a.scrollTop()+i.height()-r),s=!1},0)})}}})}}}]},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=["LeanRT",function(e){"ngInject";return{isCached:function(){try{return null!==localStorage.getItem("clientId")}catch(e){return!1}},cache:function(e){localStorage.setItem("clientId",e)},getCachedInfo:function(){try{return localStorage.getItem("clientId")}catch(e){return}},login:function(n){return e.realtime.createIMClient(n)},isLoggedin:function(){return!!e.imClient},logout:function(){return localStorage.removeItem("clientId"),e.imClient.close()}}}]},function(e,n,t){"use strict";function s(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),t(20);var i=t(1);n.default=["$scope","$rootScope","LeanRT","$state","$stateParams","$mdSidenav","userService",function(e,n,t,o,a,r,c){"ngInject";e.$mdSidenav=r,e.imClient=t.imClient,e.typingIndicator=t.imClient.createTypingIndicator(),e.normalConvs=[],e.transConvs=[],e.sysConvs=[],e.joinedTransConv=null,e.transientEmail="test@test.com",e.currentConversation=null,e.networkError=null,e.networkErrorIcon=null,e.networkShowRetry=!1;var l=function(){return e.imClient.getQuery().withLastMessagesRefreshed().containsMembers([e.imClient.id]).find()},u=function(){return e.imClient.getQuery().withLastMessagesRefreshed().equalTo("tr",!0).addAscending("createdAt").limit(1).find()},d=function(){return e.imClient.getQuery().withLastMessagesRefreshed().equalTo("sys",!0).find();
};e.getSingleConvTarget=function(n){return n[0]===e.imClient.id?n[1]:n[0]};var m=function(){return[].concat(s(e.sysConvs),s(e.transConvs),s(e.normalConvs)).reduce(function(e,n){var t=n.unreadMessagesCount;return e+t},0)};e.getConversations=function(){return Promise.all([d(),u(),l()]).then(function(n){e.sysConvs=n[0],e.transConvs=n[1],e.normalConvs=n[2],e.$emit("unreadCountUpdate",m()),e.$digest()})},e.switchToConv=function(e){o.go("conversations.message",{convId:e.id})},e.changeTo=function(n){["online","menu"].map(function(e){return r(e).close()}),n.tr===!0?e.joinedTransConv!==n&&n.join().then(function(n){e.joinedTransConv=n,e.switchToConv(n)}):e.switchToConv(n)},e.createSingleConv=function(n){var t=e.normalConvs.find(function(t){return 2===t.members.length&&e.getSingleConvTarget(t.members)===n});return t?e.switchToConv(t):e.imClient.createConversation({members:[n],name:n+" 和 "+e.imClient.id+" 的对话",transient:!1,unique:!0}).then(function(n){e.switchToConv(n)}).catch(console.error.bind(console))},e.getConversations().then(function(){return e.transConvs[0]?e.transConvs[0].join().then(function(n){e.joinedTransConv=n}):console.warn("该应用还未创建聊天室，请前往 LeanCloud 控制台创建一个暂态对话（tr 为 true 的 Conversation）。")}).catch(console.error.bind(console)),e.logout=function(){c.logout().then(function(){t.imClient=null,o.go("login")})};var g=function(n,t){t instanceof i.ChatRoom?e.transConvs.indexOf(t)===-1&&e.transConvs.push(t):t instanceof i.ServiceConversation?e.sysConvs.indexOf(t)===-1&&e.sysConvs.push(t):e.normalConvs.indexOf(t)===-1&&e.normalConvs.push(t),e.$digest()},f=function(n,t){t.transient?e.transConvs.indexOf(t)===-1&&e.transConvs.push(t):e.normalConvs.indexOf(t)===-1&&e.normalConvs.push(t),e.$digest()},v=e.imClient;v.on(i.Event.MESSAGE,g),v.on(i.Event.INVITED,f),v.on(i.Event.UNREAD_MESSAGES_COUNT_UPDATE,function(){e.$emit("unreadCountUpdate",m())}),v.on(i.Event.DISCONNECT,function(){e.networkError="连接已断开",e.networkErrorIcon="sync_problem",e.$digest()}),v.on(i.Event.OFFLINE,function(){e.networkError="网络不可用，请检查网络设置",e.networkErrorIcon="signal_wifi_off",e.networkShowRetry=!1,e.$digest()}),v.on(i.Event.ONLINE,function(){e.networkError="网络已恢复",e.$digest()}),v.on(i.Event.SCHEDULE,function(n,t){e.networkError=t/1e3+"s 后进行第 "+(n+1)+" 次重连",e.networkShowRetry=!0,e.$digest()}),v.on(i.Event.RETRY,function(n){e.networkError="正在进行第 "+(n+1)+" 次重连",e.networkErrorIcon="sync",e.networkShowRetry=!1,e.$digest()}),v.on(i.Event.RECONNECT,function(){e.networkError=null,e.joinedTransConv&&e.joinedTransConv.join(),e.$digest()}),v.on(i.Event.RECONNECT_ERROR,function(){e.networkError="重连失败，请刷新页面重试",e.networkErrorIcon="error_outline",e.$digest()}),e.$on("$destroy",function(){v.off(i.Event.MESSAGE,g),v.off(i.Event.INVITED,f),[i.Event.UNREAD_MESSAGES_COUNT_UPDATE,i.Event.DISCONNECT,i.Event.OFFLINE,i.Event.ONLINE,i.Event.SCHEDULE,i.Event.RETRY,i.Event.RECONNECT,i.Event.RECONNECT_ERROR].forEach(function(e){return v.off(e)})}),e.retry=function(){return setTimeout(function(){return t.realtime.retry()})}}]},function(e,n,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}function i(e){if(Array.isArray(e)){for(var n=0,t=Array(e.length);n<e.length;n++)t[n]=e[n];return t}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),t(21);var o=t(1),a=t(3),r=t(4),c=s(r),l=t(8),u=t(7),d=t(5),m=s(d),g=function(e,n){var t=e.slice(0,n).match(/(^|\s)@(\S*)$/);return t?t[2].toLowerCase():null},f=Symbol("system");n.default=["$scope","LeanRT","$location","$timeout","$anchorScroll","$mdDialog","$mdSidenav","$stateParams","$element",function(e,n,t,s,r,d,v,p,h){"ngInject";var b=function(){e.$digest(),s(function(){r("message-view-bottom")},0)},y=function(n){e.messages=e.messages.map(function(e){return e.id===n.id?n:e}),e.$digest()};e.messages=[],e.imClient=n.imClient,e.memberInfos=[],e.memberInfoError=null,e.hasLoadAllMessages=!1,e.maxResultsAmount=50,e.draft="",e.smileysInited=!1,e.smileysShow=!1,e.toggleSmileysSelector=function(){e.smileysInited||(e.smileysInited=!0),e.smileysShow=!e.smileysShow},e.smileys=u.smileys,e.stickers=u.stickers,e.getCurrentConversation=n.imClient.getConversation(p.convId).then(function(n){e.$parent.currentConversation=n,e.messageIterator=n.createMessagesIterator({limit:20}),e.typingIndicator=e.$parent.typingIndicator,e.typingIndicator.setConversation(n),e.typingIndicator.on("change",function(){e.typingIndicator.typingClients.length?e.typingClients=e.typingIndicator.typingClients.join(", ")+" 正在输入":e.typingClients=null,e.$digest()});var t=function(n){e.messages.push({type:f,text:n.invitedBy+" 邀请 "+n.members+" 加入对话",timestamp:new Date}),e.refreshMemberInfo(),e.$digest()},s=function(n){e.messages.push({type:f,text:n.kickedBy+" 将 "+n.members+" 移出对话",timestamp:new Date}),e.refreshMemberInfo(),e.$digest()},i=function(n){e.messages.push({type:f,text:n.kickedBy+" 将你移出对话",timestamp:new Date}),e.refreshMemberInfo(),e.$digest()},a=function(n){var t=n.attributes,s=n.updatedBy;t&&t.name&&(e.messages.push({type:f,text:s+" 将群名称修改为 "+t.name,timestamp:new Date}),e.refreshMemberInfo(),e.$digest())},r=function(n){var t=n.member,s=n.memberInfo,i=n.updatedBy;e.messages.push({type:f,text:i+" 将 "+t+" 设为 "+s.role,timestamp:new Date}),e.refreshMemberInfo(),e.$digest()},c=function(e){e.transient&&!n.transient||document.hidden||n.read()},l=function(n){n.transient&&n.type===o.Message.TYPE||(e.messages.push(n),b())},u=function(){e.$digest()},d=function(){!document.hidden&&n.unreadMessagesCount&&n.read()};return n.on(o.Event.MEMBERS_JOINED,t),n.on(o.Event.MEMBERS_LEFT,s),n.on(o.Event.KICKED,i),n.on(o.Event.INFO_UPDATED,a),n.on(o.Event.MEMBER_INFO_UPDATED,r),n.on(o.Event.MESSAGE,c),n.on(o.Event.MESSAGE,l),n.on(o.Event.LAST_DELIVERED_AT_UPDATE,u),n.on(o.Event.LAST_READ_AT_UPDATE,u),n.on("lastreadtimestampsupdate",u),n.on(o.Event.MESSAGE_RECALL,y),document.addEventListener("visibilitychange",d),e.$on("$destroy",function(){n.off(o.Event.MEMBERS_JOINED,t),n.off(o.Event.MEMBERS_LEFT,s),n.off(o.Event.KICKED,i),n.off(o.Event.INFO_UPDATED,a),n.off(o.Event.MEMBER_INFO_UPDATED,r),n.off(o.Event.MESSAGE,c),n.off(o.Event.MESSAGE,l),n.off(o.Event.LAST_DELIVERED_AT_UPDATE,u),n.off(o.Event.LAST_READ_AT_UPDATE,u),n.off("lastreadtimestampsupdate",u),n.off(o.Event.MESSAGE_RECALL,y),e.typingIndicator.off("change"),document.removeEventListener("visibilitychange",d)}),e.loadMoreMessages().then(function(){b()}),n.read(),n}),e.send=function(n){return console.log(n),e.getCurrentConversation.then(function(t){e.typingIndicator.updateStatus(0);var s=t.send(n,{receipt:2===t.members.length});return e.messages.push(n),s}).then(function(){b()}).catch(function(e){console.error(e)})},e.sendText=function(){var n=e.draft;if(n){var t=new o.TextMessage(n),s=n.match(/(^|\s)@(\S*)/g);if(s){var i=new Set(s.map(function(e){return e.trim().slice(1)}));console.log(i),i.has("all")&&(t.mentionAll(),i.delete("all")),t.setMentionList(Array.from(i))}return e.draft="",e.smileysShow=!1,e.send(t)}},e.sendImage=function(n){var t=[].concat(i(n.target.files));return n.target.form.reset(),Promise.all(t.map(function(n){return new c.default.File(n.name,n).save().then(function(n){return e.send(new a.ImageMessage(n))})})).catch(console.error)},e.sendStickers=function(n,t){var s=new m.default(n,t);return e.send(s).catch(console.error)},e.insertSmiley=function(n){var t=h.find("textarea")[0],i=t.selectionStart;e.draft=e.draft.slice(0,i)+n+e.draft.slice(t.selectionEnd),s(function(){var e=i+n.length;t.setSelectionRange(e,e),t.focus()},1)},e.loadMoreMessages=function(){if(!e.hasLoadAllMessages)return e.messageIterator.next().then(function(n){n.done&&(e.hasLoadAllMessages=!0),e.messages=n.value.concat(e.messages),e.$digest()})},e.showAddUserDialog=function(n){var t=d.prompt().title("邀请成员加入会话").placeholder("用户 ID").ariaLabel("用户 ID").targetEvent(n).required(!0).ok("邀请").cancel("取消");d.show(t).then(function(n){return e.getCurrentConversation.then(function(e){return e.add([n])})}).then(function(){}).catch(function(e){e&&console.log(e)})},e.showEditNameDialog=function(n){var t=d.prompt().title("修改群名称").placeholder("群名称").ariaLabel("群名称").initialValue(e.$parent.currentConversation.name).targetEvent(n).required(!0).ok("修改").cancel("取消");d.show(t).then(function(n){return e.$parent.currentConversation.set("name",n).save()}).catch(function(e){e&&console.log(e)})},e.remove=function(n){return e.getCurrentConversation.then(function(e){return e.remove([n])}).catch(function(e){e&&console.log(e)})},e.toggle=function(e){v(e).toggle()},e.MemberRole=o.ConversationMemberRole,e.refreshMemberInfo=function(){return e.getCurrentConversation.then(function(n){return n.getAllMemberInfo().then(function(t){return e.memberInfos=t,n.getMemberInfo(e.imClient.id).then(function(n){e.currentClientInfo=n})})}).catch(function(n){console.error(n),e.memberInfoError=n}).then(function(){return e.$digest()})},e.showMembersList=function(){v("online").open(),e.getCurrentConversation.then(function(n){if(!e.memberInfoError||119!==e.memberInfoError.code)return e.memberInfos=e.memberInfos.length?e.memberInfos:n.members.map(function(e){return{memberId:e}}),e.refreshMemberInfo()})},e.isManager=function(e){return e&&e.role===o.ConversationMemberRole.MANAGER},e.isAuthed=function(n){return n&&n.isOwner||e.isManager(n)},e.updateRole=function(n,t){return e.$parent.currentConversation.updateMemberRole(n,t).then(function(){return e.$digest()})};var C=5;e.updateMentionSuggestion=function(n){e.getCurrentConversation.then(function(n){var t=n.transient?e.messages.map(function(e){return e.from}):n.members,s=new Set(t);return s.add("all"),s.delete(e.imClient.id),s}).then(function(e){var t=[],s=[];return e.forEach(function(e){var i=e.indexOf(n);return 0===i?e.length===n.length?void(s=[n]):t.push(e):void(i>0&&s.length+t.length<C&&t.unshift(e))}),[].concat(t,i(s)).slice(-C)}).then(function(n){e.matchedClients=n,e.suggestionActive=n.length-1,e.$digest()})},e.hideMentionSuggestion=function(){e.matchedClients=[]};var M=null;e.replaceSelectedMentionedClient=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.suggestionActive,t=h.find("textarea")[0],i=t.selectionStart,o=e.draft.slice(0,i).split("@");o.pop(),o.push(e.matchedClients[n]+" "+e.draft.slice(i,e.draft.length)),e.draft=o.join("@"),s(function(){var s=i-M.length+e.matchedClients[n].length+1;t.setSelectionRange(s,s)},1)},e.editorCursorPositionCheck=function(n){var t=g(e.draft,n.target.selectionStart);t!==M&&(M=t,null===t?e.hideMentionSuggestion():e.updateMentionSuggestion(t))},e.editorKeydownHandler=function(n){var t=e.matchedClients;if(t&&t.length){var s=n.keyCode;if(38===s||40===s)return n.preventDefault(),e.suggestionActive=(t.length+e.suggestionActive+s-39)%t.length,!1;if(27===n.keyCode)return e.hideMentionSuggestion()}},e.editorChangedHandler=function(n){if(console.log(e.draft),e.draft?e.typingIndicator.updateStatus(l.TypingStatusMessage.STATUS.TYPING):e.typingIndicator.updateStatus(l.TypingStatusMessage.STATUS.FINISHED),13===n.keyCode){if(e.matchedClients&&e.matchedClients.length)return e.replaceSelectedMentionedClient(),n.preventDefault(),!1;if(!n.shiftKey)return e.sendText(),n.preventDefault(),!1}},e.recall=function(n){return console.log("recall",n),e.getCurrentConversation.then(function(e){return e.recall(n)}).then(function(e){console.log(e),y(e)}).catch(function(e){console.error(e)})}}]},function(e,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=["$state","userService","LeanRT",function(e,n,t){"ngInject";var s=n.getCachedInfo();n.login(s).then(function(s){if(t.imClient=s,n.connected=!0,e.params&&e.params.redirect){var i=JSON.parse(e.params.redirect);return e.go(i.name,i.params)}e.go("conversations")}).catch(console.error.bind(console))}]},function(e,n,t){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),t(22),n.default=["$scope","LeanRT","$state","userService",function(e,n,t,s){"ngInject";e.user={},e.login=function(){s.login(e.user.id||"Guest").then(function(e){n.imClient=e,s.cache(e.id),s.connected=!0,t.go("conversations")}).catch(console.error.bind(console))}}]},function(e,n,t){"use strict";function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(n,"__esModule",{value:!0}),n.app=void 0,t(6);var i=t(2),o=s(i);t(15),t(14),t(18);var a=t(1),r=t(4),c=s(r),l=t(3),u=t(24),d=t(8),m=t(5),g=s(m),f=t(35),v=s(f);t(23);var p=t(34),h=s(p),b=t(27),y=s(b),C=t(26),M=s(C),E=t(28),S=s(E),k=t(32),w=s(k),I=t(31),T=s(I),_=t(29),A=s(_),R=t(30),x=s(R),L=n.app="leanMessage",D="m7baukzusy3l5coew0b3em5uf4df5i2krky0ypbmee358yon",$="2e46velw0mqrq3hl2a047yjtpxn32frm0m253k258xo63ft9",O="https://leanmessage.jishuq.com";c.default.init({appId:D,appKey:$,serverURL:O}),o.default.module(L,["ui.router","ngMaterial"]).config(v.default).config(["$mdThemingProvider",function(e){"ngInject";e.theme("default").primaryPalette("blue").accentPalette("blue-grey")}]).factory("LeanRT",function(){var e={},n=new a.Realtime({appId:D,appKey:$,server:O,plugins:[l.TypedMessagesPlugin,u.GroupchatReceiptsPlugin,d.TypingIndicatorPlugin]});return n.register([g.default]),e.realtime=n,e.imClient=null,e.currentConversation=null,e}).service("userService",S.default).run(h.default).directive("infiniteList",y.default).directive("message",M.default).directive("ngUploadChange",function(){return{scope:{ngUploadChange:"&"},link:function(e,n){n.on("change",function(n){e.ngUploadChange({$event:n})}),e.$on("$destroy",function(){n.off()})}}}).controller("loginCtrl",w.default).controller("loggingCtrl",T.default).controller("convCtrl",A.default).controller("convMsgCtrl",x.default)},function(e,n){"use strict";function t(e,n,t){"ngInject";e.$on("$stateChangeStart",function(e,s,i){if("login"!==s.name&&!t.isLoggedin())if(t.isCached()){if("logging"===s.name)return;e.preventDefault(),n.go("logging",{redirect:JSON.stringify({name:s.name,params:i})})}else setTimeout(function(){return n.go("login")},0)}),e.$on("unreadCountUpdate",function(n,t){e.totalUnreadMessagesCount=t,e.$digest()})}t.$inject=["$rootScope","$state","userService"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=t},function(e,n){"use strict";function t(e,n){n.otherwise("/"),e.state("login",{url:"/",templateUrl:"app/login/login.html",controller:"loginCtrl"}).state("conversations",{url:"/conversations",templateUrl:"app/conversation/conversation.html",controller:"convCtrl"}).state("conversations.message",{url:"/:convId",templateUrl:"app/conversation/conversationMessage/conversation.message.html",controller:"convMsgCtrl"}).state("logging",{url:"/logging/:redirect",templateUrl:"app/login/logging.html",controller:"loggingCtrl"})}t.$inject=["$stateProvider","$urlRouterProvider"],Object.defineProperty(n,"__esModule",{value:!0}),n.default=t}]);